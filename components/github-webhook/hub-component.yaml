---
version: 1
kind: component
meta:
  name: argo-github-webhook
  brief: Adds a github webhook and integrates with argo
  source:
    dir: ../../components/argo-github-webhook

requires:
  - kubernetes
provides:
  - argo-event-sensor

parameters:
- name: dns.domain
  brief: DNS domain
  env: DOMAIN_NAME
- name: component.ingress
  parameters:
  - name: protocol
    value: http
  - name: urlPrefix
    value: app

- name: component.github
  parameters:
  - name: webhook.name
    env: WEBHOOK_NAME
    value: default
  - name: token
    value:
    env: GITHUB_TOKEN
    empty: allow
  - name: api
    value: api.github.com
    env: API_SERVER
  - name: repository.organization
    env: ORG
  - name: repository.organization
    env: REPO
  - name: webhook.events.json
    value: '["push"]'

- name: component.argo
  parameters:
  - name: namespace

- name: component.nats.fqdn

- name: component.argo
  parameters:
  - name: namespace
    env: NAMESPACE
    value: argoproj

lifecycle:
  bare: allow

outputs: []

templates:
  files:
  - "*.template"
